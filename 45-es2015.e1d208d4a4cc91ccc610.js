(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{yElb:function(t,e,i){"use strict";i.r(e),i.d(e,"ClientsUploadModule",function(){return it});var o=i("SVse"),n=i("s7LF"),c=i("GmJt"),a=i("3sEA"),s=i("vpPe"),r=i("GyhO"),l=i("VRyK"),d=i("Cfvw"),b=i("CHRX"),p=i("EUZL"),u=i("AytR"),g=i("8Y7J"),h=i("IheW");let f=(()=>{class t{constructor(t){this.http=t,this.listaClientes=[]}obtenerDatos(t,e,i){return this.http.get(encodeURI(`${u.a.apiURL}Clientes?filter={"where":${t},"limit":${e},"skip":${i},"order":"srazonsocial ASC"}`))}traerClientes(){return this.http.get(encodeURI(u.a.apiURL+"Clientes"))}actualizarCliente(t){return this.http.put(`${u.a.apiURL}Clientes/${t.id}`,t)}obtenerTiposClientes(){return this.http.get(encodeURI(u.a.apiURL+'Tiposcliente?filter={"where":{"deletedon":{"eq":null}}}'))}obtenerEmpresas(){return this.http.get(u.a.apiURL+"Empresas")}agregarCliente(t){return this.http.post(u.a.apiURL+"Clientes",t)}traerClientesPagina(t,e,i,o){this.http.get(encodeURI(`${u.a.apiURL}Clientes?filter={"limit":${t},"skip":${e},"order":"${i}"}`)).subscribe(n=>{n.length>0?(this.listaClientes=this.listaClientes.concat(n),this.traerClientesPagina(t,e+t,i,o)):o()})}traerProductos(t,e){this.listaClientes.length=0,this.traerClientesPagina(2e4,0,t,e)}}return t.\u0275fac=function(e){return new(e||t)(g.bc(h.c))},t.\u0275prov=g.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var m=i("5+tZ"),C=i("vkgz"),O=i("IAdc"),v=i("zHaW"),E=i("PDjf"),w=i("w9WL"),T=i("Dxy4"),y=i("Tj54"),S=i("jMqV"),I=i("TSSN");function N(t,e){if(1&t){const t=g.Yb();g.Xb(0,"div"),g.Oc(1),g.Xb(2,"button",9),g.fc("click",function(){return g.Dc(t),g.jc(),g.Ac(3).click()}),g.Xb(3,"mat-icon"),g.Oc(4,"attach_file"),g.Wb(),g.Oc(5,"Cargar archivo "),g.Wb(),g.Wb()}if(2&t){const t=g.jc();g.Eb(1),g.Qc(" ",t.fileName||"Ning\xfan archivo cargado todav\xeda."," ")}}function M(t,e){if(1&t){const t=g.Yb();g.Xb(0,"button",9),g.fc("click",function(){return g.Dc(t),g.jc(2).upload()}),g.Xb(1,"mat-icon"),g.Oc(2,"cloud_upload"),g.Wb(),g.Oc(3,"Subir "),g.Wb()}}function W(t,e){if(1&t&&(g.Xb(0,"div"),g.Oc(1),g.Xb(2,"mat-slide-toggle",10),g.Oc(3),g.kc(4,"translate"),g.Wb(),g.Mc(5,M,4,0,"button",11),g.Wb()),2&t){const t=g.jc();g.Eb(1),g.Qc(" ",t.fileName||"Ning\xfan archivo cargado todav\xeda."," "),g.Eb(1),g.pc("formControl",t.toggle),g.Eb(1),g.Pc(g.lc(4,4,"Mostrar clientes")),g.Eb(2),g.pc("ngIf",0==t.total)}}function R(t,e){if(1&t&&(g.Xb(0,"div"),g.Xb(1,"p"),g.Xb(2,"strong"),g.Oc(3,"Hay c\xf3digos duplicados:"),g.Wb(),g.Oc(4," por favor vuelva a editar el archivo de Excel y aseg\xfarese que los clientes tengan un c\xf3digo distinto cada uno que no se repita. Tambi\xe9n puede tener clientes con c\xf3digos duplicados ya cargados, en ese caso aseg\xfarese de editar los clientes con el editor."),g.Wb(),g.Xb(5,"p"),g.Oc(6),g.Wb(),g.Wb()),2&t){const t=g.jc();g.Eb(6),g.Pc(t.duplicados.join(", "))}}function X(t,e){if(1&t&&(g.Xb(0,"div"),g.Xb(1,"div",12),g.Xb(2,"p"),g.Oc(3),g.Wb(),g.Xb(4,"p"),g.Xb(5,"b",13),g.Oc(6),g.Wb(),g.Wb(),g.Wb(),g.Wb()),2&t){const t=g.jc();g.Eb(3),g.Rc("Subida: ",t.count," / ",t.total,""),g.Eb(3),g.Qc("",t.percent," %")}}function x(t,e){if(1&t&&g.Oc(0),2&t){const t=e.row;g.Qc(" ",null==t?null:t.scodcliente," ")}}function j(t,e){if(1&t&&g.Oc(0),2&t){const t=e.row;g.Qc(" ",null==t?null:t.srazonsocial," ")}}function D(t,e){if(1&t&&g.Oc(0),2&t){const t=e.row;g.Qc(" ",null==t?null:t.sdomicilio," ")}}function L(t,e){if(1&t&&g.Oc(0),2&t){const t=e.row;g.Qc(" ",null==t?null:t.scuit," ")}}function P(t,e){if(1&t&&g.Oc(0),2&t){const t=e.row;g.Qc(" ",null==t?null:t.scondicioniva," ")}}function k(t,e){1&t&&(g.Xb(0,"span"),g.Oc(1,"Si"),g.Wb())}function U(t,e){1&t&&(g.Xb(0,"span"),g.Oc(1,"No"),g.Wb())}function F(t,e){if(1&t&&(g.Mc(0,k,2,0,"span",2),g.Mc(1,U,2,0,"span",2)),2&t){const t=e.row;g.pc("ngIf","T"==(null==t?null:t.bcredito)),g.Eb(1),g.pc("ngIf","F"==(null==t?null:t.bcredito))}}function A(t,e){if(1&t&&g.Oc(0),2&t){const t=e.row;g.Qc(" ",null==t?null:t.rlimitecredito," ")}}function V(t,e){1&t&&(g.Xb(0,"span"),g.Oc(1,"Si"),g.Wb())}function z(t,e){1&t&&(g.Xb(0,"span"),g.Oc(1,"No"),g.Wb())}function H(t,e){if(1&t&&(g.Mc(0,V,2,0,"span",2),g.Mc(1,z,2,0,"span",2)),2&t){const t=e.row;g.pc("ngIf","T"==(null==t?null:t.bactivo)),g.Eb(1),g.pc("ngIf","F"==(null==t?null:t.bactivo))}}const q=function(){return{y:"50px",delay:"300ms"}},G=function(t){return{value:"*",params:t}},$=[{path:"",component:(()=>{class t{constructor(t,e,i,o){this.servicioClientes=t,this.loader=e,this.snack=i,this.servicioUUID=o,this.fileName="",this.toggle=new n.e(!1,[]),this.toggleValue=!1,this.count=0,this.percent=0,this.total=0,this.toggle.valueChanges.subscribe(t=>{this.toggleValue=t}),this.empresas=[],this.duplicados=[],this.tipoCliente=[]}ngOnInit(){this.tabla1=new b.a,this.tabla1.groupField="",this.tabla1.secondarySort="snombre",this.tabla1.sum=[],this.loader.open(),this.servicioClientes.obtenerEmpresas().subscribe(t=>{this.empresas=t,this.loader.close()},t=>{this.loader.close(),this.snack.open("ERROR","OK",{duration:4e3})})}getTipoCliente(t){var e=this.tipoCliente.find(e=>e.id==t);return e?e.stipocliente:""}convertirComoSi(t){return"T"==t?"Si":"No"}esElMismoCliente(t,e){return!("string"==typeof e["*Codigo"]&&!Object.is(e["*Codigo"],t.scodcliente)||"string"==typeof e["*Raz\xf3n Social"]&&!Object.is(e["*Raz\xf3n Social"],t.srazonsocial)||"string"==typeof e["*Domicilio"]&&!Object.is(e["*Domicilio"],t.sdomicilio)||"string"==typeof e.Localidad&&!Object.is(e.Localidad,t.slocalidad?t.slocalidad:"")||"string"==typeof e["*Condicion IVA"]&&!Object.is(e["*Condicion IVA"],t.scondicioniva)||"string"==typeof e.CUIT&&!Object.is(e.CUIT,t.scuit?t.scuit:"")||"string"==typeof e["*Documento"]&&!Object.is(e["*Documento"],t.sdocumento)||"number"==typeof e["Limite de Credito"]&&!Object.is(e["Limite de Credito"],t.rlimitecredito)||"number"==typeof e["Tope de Descuento"]&&!Object.is(e["Tope de Descuento"],t.rtopedescuento)||"string"==typeof e["Venta a Credito"]&&!Object.is("S"==e["Venta a Credito"]?"T":"F",t.bcredito)||"string"==typeof e.Activo&&!Object.is("S"==e.Activo?"T":"F",t.bactivo)||"string"==typeof e.Favorito&&!Object.is("S"==e.Favorito?"T":"F","F"!=t.bfavorito?"T":"F"))}asignarValores(t,e){t.scodcliente=e["*Codigo"],e["*Raz\xf3n Social"]&&(t.srazonsocial=e["*Raz\xf3n Social"].toString()),e["*Domicilio"]&&(t.sdomicilio=e["*Domicilio"].toString()),e.Localidad&&(t.slocalidad=e.Localidad.toString()),e["*Condicion IVA"]&&(t.scondicioniva=e["*Condicion IVA"].toString()),e.CUIT&&(t.scuit=e.CUIT.toString()),e["*Documento"]&&(t.sdocumento=e["*Documento"].toString()),"number"==typeof e["Limite de Credito"]&&(t.rlimitecredito=e["Limite de Credito"]),t.hasOwnProperty("bactivo")||(t.bactivo="T"),"string"==typeof e.Activo&&("S"===e.Activo?t.bactivo="T":"N"===e.Activo&&(t.bactivo="F")),t.hasOwnProperty("bfavorito")||(t.bfavorito="F"),t.hasOwnProperty("rtopedescuento")||(t.rtopedescuento=100),"number"==typeof e["Tope de Descuento"]&&(t.rtopedescuento=e["Tope de Descuento"]),"string"==typeof e["Venta a Credito"]&&(t.bcredito="S"==e["Venta a Credito"]?"T":"F")}onFileSelected(t){const e=t.target.files[0];if(e){this.fileName=e.name;const t=new FileReader;t.onload=e=>{var i=p.read(t.result,{type:"binary"}),o=p.utils.sheet_to_json(i.Sheets.Clientes);this.loader.open(),this.servicioClientes.traerClientes().subscribe(t=>{this.rows=[];try{o.forEach(e=>{if(null!=e["*Codigo"]&&null!=e["*Codigo"]&&""!=e["*Codigo"]){var i=t.find(t=>t.scodcliente==e["*Codigo"]);if(i){if(!this.esElMismoCliente(i,e)){var o={};Object.assign(o,i),this.asignarValores(o,e),this.rows.push(o)}}else this.asignarValores(o={},e),this.rows.push(o)}})}catch(c){console.error(c)}for(var e=[],i=0;i<o.length;i++)if(o[i]["*Codigo"]){var n=o.filter(t=>{if(t["*Codigo"])return o[i]["*Codigo"]==t["*Codigo"]});n.length>1&&e.push(o[i]["*Codigo"]+" ("+n.length+" veces)")}this.duplicados=e,this.duplicados=Array.from(new Set(e)),this.tabla1.setData(this.rows),this.loader.close()})},this.loader.close(),t.readAsBinaryString(e)}}uploadFile(t){return t.id?this.servicioClientes.actualizarCliente(t):(t.id=this.servicioUUID.generateUUID(),this.servicioClientes.agregarCliente(t))}upload(){(new Date).getTime().toString(),this.count=0,this.percent=0,this.total=this.rows.length;const t=this.rows.map(t=>this.uploadFile(t)),e=(Object(r.a)(...t),Object(l.a)(...t),Object(d.a)(t).pipe(Object(m.a)(t=>t,6)));this.sub=e.pipe(Object(C.a)(t=>this.updateProgressMeter(t)),Object(O.a)()).subscribe(t=>{},t=>{this.loader.close(),this.snack.open("ERROR","OK",{duration:4e3})})}updateProgressMeter(t){this.count++,this.percent=this.total>0?Math.round(this.count/this.total*100):0}ngOnDestroy(){this.sub&&this.sub.unsubscribe()}getRowHeight(t){return 50}onSort(t){const e=t.sorts[0];this.tabla1.secondarySort=e.prop,this.tabla1.sortDir=e.dir,this.tabla1.sortData()}}return t.\u0275fac=function(e){return new(e||t)(g.Rb(f),g.Rb(a.a),g.Rb(v.a),g.Rb(s.a))},t.\u0275cmp=g.Lb({type:t,selectors:[["app-clients-upload"]],decls:37,vars:55,consts:[["type","file","accept","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",1,"file-input",3,"change"],["fileUpload",""],[4,"ngIf"],[3,"hidden"],[1,"p-0"],[1,"material","expandable","bg-white",2,"height","70vh",3,"columnMode","headerHeight","footerHeight","rowHeight","scrollbarV","scrollbarH","rows","summaryRow","externalSorting","selectionType","sort"],["myTable",""],[3,"name","flexGrow"],["ngx-datatable-cell-template",""],["mat-raised-button","","color","primary",1,"m-8",3,"click"],[1,"m-8",3,"formControl"],["mat-raised-button","","class","m-8","color","primary",3,"click",4,"ngIf"],[2,"text-align","center"],[2,"font-size","150%"]],template:function(t,e){1&t&&(g.Xb(0,"mat-card"),g.Xb(1,"mat-card-content"),g.Xb(2,"input",0,1),g.fc("change",function(t){return e.onFileSelected(t)}),g.Wb(),g.Mc(4,N,6,1,"div",2),g.Mc(5,W,6,6,"div",2),g.Mc(6,R,7,1,"div",2),g.Mc(7,X,7,3,"div",2),g.Wb(),g.Wb(),g.Xb(8,"div",3),g.Xb(9,"mat-card",4),g.Xb(10,"mat-card-content",4),g.Xb(11,"ngx-datatable",5,6),g.fc("sort",function(t){return e.onSort(t)}),g.Xb(13,"ngx-datatable-column",7),g.kc(14,"translate"),g.Mc(15,x,1,1,"ng-template",8),g.Wb(),g.Xb(16,"ngx-datatable-column",7),g.kc(17,"translate"),g.Mc(18,j,1,1,"ng-template",8),g.Wb(),g.Xb(19,"ngx-datatable-column",7),g.kc(20,"translate"),g.Mc(21,D,1,1,"ng-template",8),g.Wb(),g.Xb(22,"ngx-datatable-column",7),g.kc(23,"translate"),g.Mc(24,L,1,1,"ng-template",8),g.Wb(),g.Xb(25,"ngx-datatable-column",7),g.kc(26,"translate"),g.Mc(27,P,1,1,"ng-template",8),g.Wb(),g.Xb(28,"ngx-datatable-column",7),g.kc(29,"translate"),g.Mc(30,F,2,2,"ng-template",8),g.Wb(),g.Xb(31,"ngx-datatable-column",7),g.kc(32,"translate"),g.Mc(33,A,1,1,"ng-template",8),g.Wb(),g.Xb(34,"ngx-datatable-column",7),g.kc(35,"translate"),g.Mc(36,H,2,2,"ng-template",8),g.Wb(),g.Wb(),g.Wb(),g.Wb(),g.Wb()),2&t&&(g.pc("@animate",g.vc(50,G,g.uc(49,q))),g.Eb(4),g.pc("ngIf",!e.fileName),g.Eb(1),g.pc("ngIf",e.fileName),g.Eb(1),g.pc("ngIf",e.duplicados.length>0),g.Eb(1),g.pc("ngIf",e.total>0),g.Eb(1),g.pc("hidden",!e.toggleValue),g.Eb(1),g.pc("@animate",g.vc(53,G,g.uc(52,q))),g.Eb(2),g.pc("columnMode","flex")("headerHeight",50)("footerHeight",100)("rowHeight",e.getRowHeight)("scrollbarV",!0)("scrollbarH",!1)("rows",e.tabla1.rows)("summaryRow",!1)("externalSorting",!0)("selectionType","single"),g.Eb(2),g.qc("name",g.lc(14,33,"CLIENTSCOMPONENT.CODE")),g.pc("flexGrow",1),g.Eb(3),g.qc("name",g.lc(17,35,"CLIENTSCOMPONENT.BUSINESSNAME")),g.pc("flexGrow",1),g.Eb(3),g.qc("name",g.lc(20,37,"CLIENTSCOMPONENT.ADDRESS")),g.pc("flexGrow",1),g.Eb(3),g.qc("name",g.lc(23,39,"CLIENTSCOMPONENT.CUIT")),g.pc("flexGrow",1),g.Eb(3),g.qc("name",g.lc(26,41,"CLIENTSCOMPONENT.FISCALCONDITION")),g.pc("flexGrow",1),g.Eb(3),g.qc("name",g.lc(29,43,"CLIENTSCOMPONENT.CREDIT")),g.pc("flexGrow",1),g.Eb(3),g.qc("name",g.lc(32,45,"CLIENTSCOMPONENT.CREDITLIMIT")),g.pc("flexGrow",1),g.Eb(3),g.qc("name",g.lc(35,47,"CLIENTSCOMPONENT.ACTIVE")),g.pc("flexGrow",1))},directives:[E.a,E.b,o.o,w.d,w.b,w.a,T.b,y.a,S.a,n.o,n.f],pipes:[I.c],styles:[".file-input[_ngcontent-%COMP%]{display:none}.progress[_ngcontent-%COMP%]{display:block;width:16px;height:16px;border:1px solid #000;float:left;margin:0 4px 4px 0}.progress.uploading[_ngcontent-%COMP%]{background:gold}.progress.uploaded[_ngcontent-%COMP%], uploading[_ngcontent-%COMP%]{background:green}"],data:{animation:[c.a]}}),t})(),data:{title:"SUBIR CLIENTES"}}];var Q=i("iInd"),_=i("u9T3"),J=i("f44v"),Z=i("iELJ"),B=i("e6WT"),K=i("ZTz/"),Y=i("M9ds"),tt=i("ZFy/"),et=i("PCNd");let it=(()=>{class t{}return t.\u0275mod=g.Pb({type:t}),t.\u0275inj=g.Ob({factory:function(e){return new(e||t)},imports:[[o.c,n.t,_.a,w.f,B.c,B.c,E.c,B.c,T.c,J.a,B.c,tt.b,Z.f,v.b,S.b,Y.c,K.b,y.b,I.b,et.a,Q.k.forChild($)]]}),t})()}}]);