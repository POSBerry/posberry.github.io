!function(){function t(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,i){if(!t)return;if("string"==typeof t)return o(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return o(t,i)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,o){(null==o||o>t.length)&&(o=t.length);for(var i=0,e=new Array(o);i<o;i++)e[i]=t[i];return e}function i(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function e(t,o){for(var i=0;i<o.length;i++){var e=o[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function r(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{"2Doj":function(o,e,s){"use strict";s.r(e),s.d(e,"NewPurchaseModule",function(){return L});var a,c,n,u=s("SVse"),h=s("3sEA"),p=s("vpPe"),m=s("wd/R"),d=s("cp0P"),l=s("Sp5M"),f=s("qA6C"),v=s("UVsP"),_=s("AytR"),C=s("8Y7J"),b=s("IheW"),F=((a=function(){function t(o){i(this,t),this.http=o}return r(t,[{key:"obtenerImpuestos",value:function(){return this.http.get(_.a.apiURL+'Impuestos?filter={"where":{"deletedon":{"eq":null}}}')}},{key:"obtenerSucursales",value:function(){return this.http.get(_.a.apiURL+'Sucursales?filter={"where":{"deletedon":{"eq":null}}}')}}]),t}()).\u0275fac=function(t){return new(t||a)(C.bc(b.c))},a.\u0275prov=C.Nb({token:a,factory:a.\u0275fac,providedIn:"root"}),a),y=s("zHaW"),g=[{path:"",component:(c=function(){function o(t,e,r,s,a,c,n){i(this,o),this.servicioUUID=t,this.loader=e,this.snack=r,this.servicioNuevaCompra=s,this.servicioProductos=a,this.servicioEmpresas=c,this.servicioSucursales=n,this.sucursal="",this.form_tipoFactura="",this.form_tipoDocumento="",this.error_iva=!1,this.tipoFacturaBloqueado=!1,this.sucursal="",this.tiposDocumento=[],this.tiposFactura=["PRODUCTOS","SERVICIOS"],this.detalle=[],this.detalleimpuestos=[],this.fechaFiltroInicio=new Date,this.fechaFiltroFin=m().add(1,"days").toDate()}return r(o,[{key:"ngOnInit",value:function(){var t=this;this.loader.open(),this.servicioProductos.traerProductos("snombre ASC",function(){t.productos=t.servicioProductos.listaProductos,Object(d.a)([t.servicioEmpresas.obtenerEmpresas(),t.servicioProductos.obtenerProveedores(),t.servicioNuevaCompra.obtenerImpuestos(),t.servicioNuevaCompra.obtenerSucursales()]).subscribe(function(o){t.empresas=o[0],t.cantidaddecimales=o[0].cantidaddecimales,t.proveedores=o[1],t.impuestos=o[2],t.sucursales_data=o[3],t.loader.close()},function(o){t.loader.close(),t.snack.open("ERROR","OK",{duration:4e3})})},function(o){t.loader.close(),t.snack.open("ERROR","OK",{duration:4e3})})}},{key:"renameKeys",value:function(o,i){var e=Object.keys(o).map(function(t){return function(t,o,i){return o in t?Object.defineProperty(t,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[o]=i,t}({},i[t]||t,o[t])});return Object.assign.apply(Object,[{}].concat(t(e)))}},{key:"obtenerNombreProveedor",value:function(t){if(this.proveedores)for(var o=0;o<this.proveedores.length;o++)if(this.proveedores[o].id==t)return this.proveedores[o].srazonsocial;return""}},{key:"obtenerNombreProducto",value:function(t,o){for(var i=0;i<this.productos.length;i++)if(this.productos[i].id==t)return this.productos[i].snombre;return o}},{key:"obtenerCodigoProducto",value:function(t){for(var o=0;o<this.productos.length;o++)if(this.productos[o].id==t)return this.productos[o].scodproducto;return""}},{key:"cambiarProveedor",value:function(t){var o="T"==t.bdeproductos,i="T"==t.bdeservicios;this.tipoFacturaBloqueado=!1,this.form_tipoFactura=this.tiposFactura[0],o&&!i&&(this.tipoFacturaBloqueado=!0,this.form_tipoFactura=this.tiposFactura[0]),i&&!o&&(this.tipoFacturaBloqueado=!0,this.form_tipoFactura=this.tiposFactura[1]),this.cargarTiposDocumento(t.scondicioniva,o)}},{key:"cargarTiposDocumento",value:function(t,o){this.tiposDocumento=["Presupuesto de Compra","Nota de Cr\xe9dito Presupuesto de Compra"],this.form_tipoDocumento="Presupuesto de Compra",o&&this.tiposDocumento.push("Remito de Compra"),"Monotributista"==this.empresas[0].scondicioniva&&("Responsable Inscripto"==t&&(this.tiposDocumento.push("Factura de Compra B"),this.tiposDocumento.push("Nota de Cr\xe9dito B"),this.form_tipoDocumento="Factura de Compra B"),"Monotributista"==t&&(this.tiposDocumento.push("Factura de Compra C"),this.tiposDocumento.push("Nota de Cr\xe9dito C"),this.form_tipoDocumento="Factura de Compra C")),"Responsable Inscripto"==this.empresas[0].scondicioniva&&("Responsable Inscripto"==t&&(this.tiposDocumento.push("Factura de Compra A"),this.tiposDocumento.push("Nota de Cr\xe9dito A"),this.form_tipoDocumento="Factura de Compra A"),"Monotributista"==t&&(this.tiposDocumento.push("Factura de Compra C"),this.tiposDocumento.push("Nota de Cr\xe9dito C"),this.form_tipoDocumento="Factura de Compra C")),"Consumidor Final"==this.empresas[0].scondicioniva&&("Responsable Inscripto"==t&&(this.tiposDocumento.push("Factura de Compra B"),this.tiposDocumento.push("Nota de Cr\xe9dito B"),this.form_tipoDocumento="Factura de Compra B"),"Monotributista"==t&&(this.tiposDocumento.push("Factura de Compra C"),this.tiposDocumento.push("Nota de Cr\xe9dito C"),this.form_tipoDocumento="Factura de Compra C"))}},{key:"buscarProducto",value:function(t){for(var o=0;o<this.productos.length;o++)if(this.productos[o].id==t)return this.productos[o];return{}}},{key:"editarItem",value:function(t){this.temp_item=t,this.form_tipoFactura==this.tiposFactura[0]?(this.form_precio=t.rpreciou,this.form_cantidad=t.rcantidad,this.form_producto=this.buscarProducto(t.idproducto)):(this.form_precio=t.rpreciou,this.form_cantidad=t.rcantidad,this.form_producto=t.sconcepto)}},{key:"eliminarItem",value:function(t){var o=this.items.indexOf(t);this.items.splice(o,1),this.calcular_total(!0)}},{key:"guardarItem",value:function(){this.form_cantidad=this.form_cantidad?this.form_cantidad:1;var t=this.items.indexOf(this.temp_item),o=this.form_precio,i=this.form_precio_final;"Factura de Compra A"!=this.form_tipoDocumento&&"Nota de Cr\xe9dito A"!=this.form_tipoDocumento&&(o=parseFloat((i.formatMoneySinMiles(2)/1.21).toFixed(this.cantidaddecimales))),-1!=t?(this.form_tipoFactura==this.tiposFactura[0]?(this.items[t].idproducto=this.form_producto.id,this.items[t].rcantidad=this.form_cantidad,this.items[t].rpreciou=i,this.items[t].rprecioneto=o,this.items[t].rporciva=this.form_producto.rporciva,this.items[t].rtotal=i*this.form_cantidad,this.items[t].rtotalneto=o*this.form_cantidad,this.items[t].rimpuestos=Math.abs(i-o),this.items[t].sconcepto=this.form_producto.snombre):(this.items[t].idproducto=null,this.items[t].rcantidad=this.form_cantidad,this.items[t].rpreciou=i,this.items[t].rprecioneto=o,this.items[t].rporciva=21,this.items[t].rtotal=i*this.form_cantidad,this.items[t].rtotalneto=o*this.form_cantidad,this.items[t].rimpuestos=Math.abs(i-o),this.items[t].sconcepto=this.form_producto),this.items[t].impuesto_iva=this.items[t].rporciva/100*this.items[t].rtotalneto,this.items[t].impuesto_dgr=this.items[t].rporcdgr/100*this.items[t].rtotalneto,this.items[t].impuesto_interno=this.items[t].rvalorimpinterno*this.items[t].rcantidad):(this.items.push(this.form_tipoFactura==this.tiposFactura[0]?{id:this.servicioUUID.generateUUID(),idproducto:this.form_producto.id,rcantidad:this.form_cantidad,rpreciou:i,rprecioneto:o,rporciva:this.form_producto.rporciva,rtotal:this.form_cantidad*i,rtotalneto:o*this.form_cantidad,rimpuestos:Math.abs(i-o),sconcepto:this.form_producto.snombre}:{id:this.servicioUUID.generateUUID(),idproducto:null,rcantidad:this.form_cantidad,rpreciou:i,rprecioneto:o,rporciva:21,rtotal:this.form_cantidad*i,rtotalneto:o*this.form_cantidad,rimpuestos:Math.abs(i-o),sconcepto:this.form_producto}),this.items[this.items.length-1].impuesto_iva=this.items[this.items.length-1].rporciva/100*this.items[this.items.length-1].rtotalneto,this.items[this.items.length-1].impuesto_dgr=this.items[this.items.length-1].rporcdgr/100*this.items[this.items.length-1].rtotalneto,this.items[this.items.length-1].impuesto_interno=this.items[this.items.length-1].rvalorimpinterno*this.items[this.items.length-1].rcantidad),this.form_precio=0,this.form_precio_final=0,this.form_cantidad=1,this.form_producto="",this.temp_item=null,this.calcular_total(!0)}},{key:"tipoComprobanteDeCompra",value:function(t){return"Presupuesto de Compra"==t?"PDC":"Remito de Compra"==t?"RMC":"Factura de Compra A"==t?"CCA":"Factura de Compra B"==t?"CCB":"Factura de Compra C"==t?"CCC":"Nota de Cr\xe9dito A"==t?"CNA":"Nota de Cr\xe9dito B"==t?"CNB":"Nota de Cr\xe9dito C"==t?"CNC":"Nota de Cr\xe9dito Presupuesto de Compra"==t?"PSC":void 0}},{key:"querySearch",value:function(t){if(""==t)return this.proveedores;var o=[];t=(t=t.toLowerCase()).split(" ");for(var i=0;i<this.proveedores.length;i++){for(var e=this.proveedores[i].srazonsocial.toLowerCase(),r=!0,s=0;s<t.length;s++)if(-1==e.indexOf(t[s])){r=!1;break}r&&o.push(this.proveedores[i])}return o}},{key:"querySearchProducto",value:function(t){if(""==t)return this.productos;var o=[];t=(t=t.toLowerCase()).split(" ");for(var i=0;i<this.productos.length;i++)for(var e=this.productos[i],r=0;r<t.length;r++){var s=t[r];if(-1==e.snombre.toLowerCase().indexOf(s)&&e.scodproducto.toLowerCase()!=s&&e.sean!=s&&e.sean2!=s)break;o.push(this.productos[i])}return o}},{key:"selectedItemChangeProducto",value:function(t){t&&null!=t.rcostou&&(this.form_precio=t.rcostou),this.calcular_precio_neto(),this.calcular_precio_final()}},{key:"calcular_precio_neto",value:function(){var t=this.form_producto;"Factura de Compra A"!=this.form_tipoDocumento&&"Nota de Cr\xe9dito A"!=this.form_tipoDocumento||(this.form_precio=parseFloat(((t.rcostou-t.rvalorimpinterno)/(t.rporciva/100+t.rporcdgr/100+1)).toFixed(this.cantidaddecimales)),this.form_precio=t&&t.rcostou&&t.rporciva&&t.rporcdgr&&null!=t.rvalorimpinterno?parseFloat(((t.rcostou-t.rvalorimpinterno)/(t.rporciva/100+t.rporcdgr/100+1)).toFixed(this.cantidaddecimales)):0)}},{key:"calcular_precio_final",value:function(){var t=this.form_producto;this.form_precio_final="Factura de Compra A"==this.form_tipoDocumento||"Nota de Cr\xe9dito A"==this.form_tipoDocumento?parseFloat((this.form_precio*(t.rporciva/100+t.rporcdgr/100+1)+t.rvalorimpinterno).toFixed(this.cantidaddecimales).formatMoneySinMiles(2)):this.form_precio}},{key:"nuevaCompra",value:function(){this.form_proveedor="",this.fecha=new Date,this.fechacontable=new Date,this.fechacaicae=m().add(10,"days").toDate(),this.items=[],this.form_precio=0,this.form_cantidad=1,this.form_producto="",this.form_tipoFactura=this.tiposFactura[0],this.form_tipoDocumento=this.tiposDocumento[0],this.form_numero="",this.form_caicae="",this.form_afectarStock=!1,this.form_descuento=0,this.form_proveedor=this.proveedores[0],this.subtotal=0,this.iva=0,this.total=0,this.lista_impuestos=[],this.lista_impuestos=[];for(var t=0;t<this.impuestos.length;t++)this.lista_impuestos.push({id:this.impuestos[t].id,simpuesto:this.impuestos[t].simpuesto,total:0,idempresa:this.impuestos[t].idempresa,rporc:this.impuestos[t].rporc})}},{key:"cancelarCompra",value:function(){}},{key:"fechaAfip",value:function(){var t=this.fechacaicae,o=t.getUTCMonth()+1,i=t.getUTCDate(),e=t.getUTCFullYear();return e=o<10?e+"0"+o:e+""+o,i<10?e+"0"+i:e+""+i}},{key:"EsNotaDeCredito",value:function(t){return"CNA"==t||"CNB"==t||"CNC"==t||"CND"==t||"PSC"==t}},{key:"generarCompra",value:function(t,o){this.servicioUUID.generateUUID(),this.tipoComprobanteDeCompra(this.form_tipoDocumento),this.fecha.toISOString(),(new Date).toISOString(),this.fecha.toISOString(),this.fechacontable.toISOString(),this.EsNotaDeCredito(this.tipoComprobanteDeCompra(this.form_tipoDocumento))}},{key:"verificar_iva",value:function(){this.error_iva=this.total_impuestos!=this.iva}},{key:"calcular_total_impuestos",value:function(){for(var t=0,o=0;o<this.lista_impuestos.length;o++)t+=this.lista_impuestos[o].total;this.total_impuestos=parseFloat(t.toFixed(this.cantidaddecimales)),this.iva=this.total_impuestos}},{key:"calcular_total",value:function(t){for(var o=0,i=0,e=0;e<this.items.length;e++)o+=this.items[e].rtotal,i+=this.items[e].rtotalneto;if(t){for(var r=0;r<this.lista_impuestos.length;r++)this.lista_impuestos[r].total=0;for(e=0;e<this.items.length;e++)for(r=0;r<this.lista_impuestos.length;r++){if(this.items[e].rporciva==this.lista_impuestos[r].rporc){this.lista_impuestos[r].total+=this.items[e].impuesto_iva;break}if(this.items[e].rporcdgr==this.lista_impuestos[r].rporc){this.lista_impuestos[r].total+=this.items[e].impuesto_dgr;break}if(this.items[e].rvalorimpinterno==this.lista_impuestos[r].rporc){this.lista_impuestos[r].total+=this.items[e].impuesto_interno;break}}for(r=0;r<this.lista_impuestos.length;r++)this.lista_impuestos[r].total=parseFloat(this.lista_impuestos[r].total.toFixed(this.cantidaddecimales))}"Factura de Compra A"==this.form_tipoDocumento||"Nota de Cr\xe9dito A"==this.form_tipoDocumento?(this.calcular_total_impuestos(),this.subtotal=parseFloat(i.toFixed(this.cantidaddecimales))):(this.subtotal=parseFloat(o.toFixed(this.cantidaddecimales)),this.iva=0),this.total=parseFloat((this.subtotal-this.form_descuento+this.iva).toFixed(this.cantidaddecimales))}}]),o}(),c.\u0275fac=function(t){return new(t||c)(C.Rb(p.a),C.Rb(h.a),C.Rb(y.a),C.Rb(F),C.Rb(f.a),C.Rb(l.a),C.Rb(v.a))},c.\u0275cmp=C.Lb({type:c,selectors:[["app-new-purchase"]],decls:2,vars:0,template:function(t,o){1&t&&(C.Xb(0,"p"),C.Oc(1,"new-purchase works!"),C.Wb())},styles:[""]}),c),data:{title:"NUEVA COMPRA"}}],D=s("iInd"),k=s("u9T3"),N=s("s7LF"),P=s("Dxy4"),w=s("PDjf"),I=s("f44v"),S=s("iELJ"),A=s("Tj54"),O=s("e6WT"),R=s("ZTz/"),U=s("jMqV"),M=s("M9ds"),B=s("ZFy/"),j=s("TSSN"),x=s("w9WL"),T=s("PCNd"),E=s("BxcV"),L=((n=function t(){i(this,t)}).\u0275mod=C.Pb({type:n}),n.\u0275inj=C.Ob({factory:function(t){return new(t||n)},imports:[[u.c,N.t,k.a,x.f,O.c,O.c,w.c,O.c,P.c,I.a,O.c,B.b,S.f,y.b,U.b,M.c,R.b,A.b,j.b,T.a,E.a,D.k.forChild(g)]]}),n)}}])}();