(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{"2Doj":function(t,o,i){"use strict";i.r(o),i.d(o,"NewPurchaseModule",function(){return K});var e=i("SVse"),r=i("s7LF"),s=i("3sEA"),a=i("vpPe"),c=i("wd/R"),n=i("cp0P"),p=i("JX91"),m=i("lJxs"),h=i("Sp5M"),u=i("qA6C"),d=i("UVsP"),l=i("AytR"),f=i("8Y7J"),b=i("IheW");let _=(()=>{class t{constructor(t){this.http=t}obtenerImpuestos(){return this.http.get(l.a.apiURL+'Impuestos?filter={"where":{"deletedon":{"eq":null}}}')}obtenerSucursales(){return this.http.get(l.a.apiURL+'Sucursales?filter={"where":{"deletedon":{"eq":null}},"order":"sdescripcion ASC"}')}}return t.\u0275fac=function(o){return new(o||t)(f.bc(b.c))},t.\u0275prov=f.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var v=i("zHaW"),C=i("VDRc"),F=i("Q2Ze"),g=i("e6WT"),D=i("vrAh"),P=i("ZTz/"),w=i("pMoy"),O=i("UhP/"),S=i("TSSN");function x(t,o){if(1&t&&(f.Xb(0,"mat-option",19),f.Oc(1),f.Wb()),2&t){const t=o.$implicit;f.pc("value",t),f.Eb(1),f.Qc(" ",null==t?null:t.srazonsocial," ")}}function N(t,o){if(1&t&&(f.Xb(0,"mat-option",19),f.Oc(1),f.Wb()),2&t){const t=o.$implicit;f.pc("value",t),f.Eb(1),f.Qc(" ",t," ")}}function M(t,o){if(1&t&&(f.Xb(0,"mat-option",19),f.Oc(1),f.Wb()),2&t){const t=o.$implicit;f.pc("value",t),f.Eb(1),f.Qc(" ",t," ")}}function I(t,o){if(1&t&&(f.Xb(0,"mat-option",19),f.Oc(1),f.Wb()),2&t){const t=o.$implicit;f.pc("value",t),f.Eb(1),f.Qc(" ",t.sdescripcion," ")}}function E(t,o){if(1&t){const t=f.Yb();f.Xb(0,"mat-form-field",8),f.Xb(1,"mat-label"),f.Oc(2),f.kc(3,"translate"),f.Wb(),f.Xb(4,"mat-select",9),f.fc("ngModelChange",function(o){return f.Dc(t),f.jc().form_sucursal=o}),f.Mc(5,I,2,2,"mat-option",6),f.Wb(),f.Wb()}if(2&t){const t=f.jc();f.Eb(2),f.Pc(f.lc(3,3,"Dep\xf3sito de la Sucursal")),f.Eb(2),f.pc("ngModel",t.form_sucursal),f.Eb(1),f.pc("ngForOf",t.sucursales_data)}}const W=[{path:"",component:(()=>{class t{constructor(t,o,i,e,s,a,n){this.servicioUUID=t,this.loader=o,this.snack=i,this.servicioNuevaCompra=e,this.servicioProductos=s,this.servicioEmpresas=a,this.servicioSucursales=n,this.editorProveedor=new r.e(""),this.sucursal="",this.startDate=new r.e,this.endDate=new r.e,this.form_tipoFactura="",this.form_tipoDocumento="",this.form_numero=new r.e(""),this.form_afectarStock=new r.e(""),this.form_numero_sucursal=new r.e(""),this.form_acredito=new r.e(""),this.error_iva=!1,this.tipoFacturaBloqueado=!1,this.sucursal="",this.tiposDocumento=[],this.tiposFactura=["PRODUCTOS","SERVICIOS"],this.detalle=[],this.detalleimpuestos=[],this.fechaFiltroInicio=new Date,this.fechaFiltroFin=c().add(1,"days").toDate()}_filterProveedores(t){if("string"==typeof t){const o=t.toLowerCase();return this.proveedores.filter(t=>t.srazonsocial.toLowerCase().includes(o))}return[]}displayFnProveedores(t){return t&&t.srazonsocial?t.srazonsocial:""}ngOnInit(){var t=new Date;t.setHours(0,0,0,0);var o=new Date;o.setHours(23,59,59,999),this.startDate.setValue(t),this.endDate.setValue(o),this.loader.open(),this.servicioProductos.traerProductos("snombre ASC",()=>{this.productos=this.servicioProductos.listaProductos,Object(n.a)([this.servicioEmpresas.obtenerEmpresas(),this.servicioProductos.obtenerProveedores(),this.servicioNuevaCompra.obtenerImpuestos(),this.servicioNuevaCompra.obtenerSucursales()]).subscribe(t=>{this.empresas=t[0],this.cantidaddecimales=t[0].cantidaddecimales,this.proveedores=t[1],this.impuestos=t[2],this.sucursales_data=t[3],this.filteredProveedores=this.editorProveedor.valueChanges.pipe(Object(p.a)(""),Object(m.a)(t=>this._filterProveedores(t))),this.nuevaCompra(),this.loader.close()},t=>{this.loader.close(),this.snack.open("ERROR","OK",{duration:4e3})})},t=>{this.loader.close(),this.snack.open("ERROR","OK",{duration:4e3})})}renameKeys(t,o){const i=Object.keys(t).map(i=>({[o[i]||i]:t[i]}));return Object.assign({},...i)}obtenerNombreProveedor(t){if(this.proveedores)for(var o=0;o<this.proveedores.length;o++)if(this.proveedores[o].id==t)return this.proveedores[o].srazonsocial;return""}obtenerNombreProducto(t,o){for(var i=0;i<this.productos.length;i++)if(this.productos[i].id==t)return this.productos[i].snombre;return o}obtenerCodigoProducto(t){for(var o=0;o<this.productos.length;o++)if(this.productos[o].id==t)return this.productos[o].scodproducto;return""}cambiarTiposFactura(){this.form_producto=""}cambiarProveedor(t){var o="T"==t.bdeproductos,i="T"==t.bdeservicios;this.tipoFacturaBloqueado=!1,this.form_tipoFactura=this.tiposFactura[0],o&&!i&&(this.tipoFacturaBloqueado=!0,this.form_tipoFactura=this.tiposFactura[0]),i&&!o&&(this.tipoFacturaBloqueado=!0,this.form_tipoFactura=this.tiposFactura[1]),this.cargarTiposDocumento(t.scondicioniva,o)}cargarTiposDocumento(t,o){this.tiposDocumento=["Presupuesto de Compra","Nota de Cr\xe9dito Presupuesto de Compra"],this.form_tipoDocumento="Presupuesto de Compra",o&&this.tiposDocumento.push("Remito de Compra"),"Monotributista"==this.empresas[0].scondicioniva&&("Responsable Inscripto"==t&&(this.tiposDocumento.push("Factura de Compra B"),this.tiposDocumento.push("Nota de Cr\xe9dito B"),this.form_tipoDocumento="Factura de Compra B"),"Monotributista"==t&&(this.tiposDocumento.push("Factura de Compra C"),this.tiposDocumento.push("Nota de Cr\xe9dito C"),this.form_tipoDocumento="Factura de Compra C")),"Responsable Inscripto"==this.empresas[0].scondicioniva&&("Responsable Inscripto"==t&&(this.tiposDocumento.push("Factura de Compra A"),this.tiposDocumento.push("Nota de Cr\xe9dito A"),this.form_tipoDocumento="Factura de Compra A"),"Monotributista"==t&&(this.tiposDocumento.push("Factura de Compra C"),this.tiposDocumento.push("Nota de Cr\xe9dito C"),this.form_tipoDocumento="Factura de Compra C")),"Consumidor Final"==this.empresas[0].scondicioniva&&("Responsable Inscripto"==t&&(this.tiposDocumento.push("Factura de Compra B"),this.tiposDocumento.push("Nota de Cr\xe9dito B"),this.form_tipoDocumento="Factura de Compra B"),"Monotributista"==t&&(this.tiposDocumento.push("Factura de Compra C"),this.tiposDocumento.push("Nota de Cr\xe9dito C"),this.form_tipoDocumento="Factura de Compra C"))}buscarProducto(t){for(var o=0;o<this.productos.length;o++)if(this.productos[o].id==t)return this.productos[o];return{}}editarItem(t){this.temp_item=t,this.form_tipoFactura==this.tiposFactura[0]?(this.form_precio=t.rpreciou,this.form_cantidad=t.rcantidad,this.form_producto=this.buscarProducto(t.idproducto)):(this.form_precio=t.rpreciou,this.form_cantidad=t.rcantidad,this.form_producto=t.sconcepto)}eliminarItem(t){var o=this.items.indexOf(t);this.items.splice(o,1),this.calcular_total(!0)}guardarItem(){this.form_cantidad=this.form_cantidad?this.form_cantidad:1;var t=this.items.indexOf(this.temp_item),o=this.form_precio,i=this.form_precio_final;"Factura de Compra A"!=this.form_tipoDocumento&&"Nota de Cr\xe9dito A"!=this.form_tipoDocumento&&(o=parseFloat((i.formatMoneySinMiles(2)/1.21).toFixed(this.cantidaddecimales))),-1!=t?(this.form_tipoFactura==this.tiposFactura[0]?(this.items[t].idproducto=this.form_producto.id,this.items[t].rcantidad=this.form_cantidad,this.items[t].rpreciou=i,this.items[t].rprecioneto=o,this.items[t].rporciva=this.form_producto.rporciva,this.items[t].rtotal=i*this.form_cantidad,this.items[t].rtotalneto=o*this.form_cantidad,this.items[t].rimpuestos=Math.abs(i-o),this.items[t].sconcepto=this.form_producto.snombre):(this.items[t].idproducto=null,this.items[t].rcantidad=this.form_cantidad,this.items[t].rpreciou=i,this.items[t].rprecioneto=o,this.items[t].rporciva=21,this.items[t].rtotal=i*this.form_cantidad,this.items[t].rtotalneto=o*this.form_cantidad,this.items[t].rimpuestos=Math.abs(i-o),this.items[t].sconcepto=this.form_producto),this.items[t].impuesto_iva=this.items[t].rporciva/100*this.items[t].rtotalneto,this.items[t].impuesto_dgr=this.items[t].rporcdgr/100*this.items[t].rtotalneto,this.items[t].impuesto_interno=this.items[t].rvalorimpinterno*this.items[t].rcantidad):(this.items.push(this.form_tipoFactura==this.tiposFactura[0]?{id:this.servicioUUID.generateUUID(),idproducto:this.form_producto.id,rcantidad:this.form_cantidad,rpreciou:i,rprecioneto:o,rporciva:this.form_producto.rporciva,rtotal:this.form_cantidad*i,rtotalneto:o*this.form_cantidad,rimpuestos:Math.abs(i-o),sconcepto:this.form_producto.snombre}:{id:this.servicioUUID.generateUUID(),idproducto:null,rcantidad:this.form_cantidad,rpreciou:i,rprecioneto:o,rporciva:21,rtotal:this.form_cantidad*i,rtotalneto:o*this.form_cantidad,rimpuestos:Math.abs(i-o),sconcepto:this.form_producto}),this.items[this.items.length-1].impuesto_iva=this.items[this.items.length-1].rporciva/100*this.items[this.items.length-1].rtotalneto,this.items[this.items.length-1].impuesto_dgr=this.items[this.items.length-1].rporcdgr/100*this.items[this.items.length-1].rtotalneto,this.items[this.items.length-1].impuesto_interno=this.items[this.items.length-1].rvalorimpinterno*this.items[this.items.length-1].rcantidad),this.form_precio=0,this.form_precio_final=0,this.form_cantidad=1,this.form_producto="",this.temp_item=null,this.calcular_total(!0)}tipoComprobanteDeCompra(t){return"Presupuesto de Compra"==t?"PDC":"Remito de Compra"==t?"RMC":"Factura de Compra A"==t?"CCA":"Factura de Compra B"==t?"CCB":"Factura de Compra C"==t?"CCC":"Nota de Cr\xe9dito A"==t?"CNA":"Nota de Cr\xe9dito B"==t?"CNB":"Nota de Cr\xe9dito C"==t?"CNC":"Nota de Cr\xe9dito Presupuesto de Compra"==t?"PSC":void 0}querySearch(t){if(""==t)return this.proveedores;var o=[];t=(t=t.toLowerCase()).split(" ");for(var i=0;i<this.proveedores.length;i++){for(var e=this.proveedores[i].srazonsocial.toLowerCase(),r=!0,s=0;s<t.length;s++)if(-1==e.indexOf(t[s])){r=!1;break}r&&o.push(this.proveedores[i])}return o}querySearchProducto(t){if(""==t)return this.productos;var o=[];t=(t=t.toLowerCase()).split(" ");for(var i=0;i<this.productos.length;i++)for(var e=this.productos[i],r=0;r<t.length;r++){var s=t[r];if(-1==e.snombre.toLowerCase().indexOf(s)&&e.scodproducto.toLowerCase()!=s&&e.sean!=s&&e.sean2!=s)break;o.push(this.productos[i])}return o}selectedItemChangeProducto(t){t&&null!=t.rcostou&&(this.form_precio=t.rcostou),this.calcular_precio_neto(),this.calcular_precio_final()}calcular_precio_neto(){var t=this.form_producto;"Factura de Compra A"!=this.form_tipoDocumento&&"Nota de Cr\xe9dito A"!=this.form_tipoDocumento||(this.form_precio=parseFloat(((t.rcostou-t.rvalorimpinterno)/(t.rporciva/100+t.rporcdgr/100+1)).toFixed(this.cantidaddecimales)),this.form_precio=t&&t.rcostou&&t.rporciva&&t.rporcdgr&&null!=t.rvalorimpinterno?parseFloat(((t.rcostou-t.rvalorimpinterno)/(t.rporciva/100+t.rporcdgr/100+1)).toFixed(this.cantidaddecimales)):0)}calcular_precio_final(){var t=this.form_producto;this.form_precio_final="Factura de Compra A"==this.form_tipoDocumento||"Nota de Cr\xe9dito A"==this.form_tipoDocumento?parseFloat((this.form_precio*(t.rporciva/100+t.rporcdgr/100+1)+t.rvalorimpinterno).toFixed(this.cantidaddecimales).formatMoneySinMiles(2)):this.form_precio}nuevaCompra(){this.fecha=new Date,this.fechacontable=new Date,this.fechacaicae=c().add(10,"days").toDate(),this.items=[],this.form_precio=0,this.form_cantidad=1,this.form_producto="",this.form_tipoFactura=this.tiposFactura[0],this.form_tipoDocumento=this.tiposDocumento[0],this.form_numero.setValue(""),this.form_caicae="",this.form_afectarStock.setValue(!1),this.form_descuento=0,this.form_sucursal=this.sucursales_data[0],this.editorProveedor.setValue(this.proveedores[0]),this.cambiarProveedor(this.proveedores[0]),this.subtotal=0,this.iva=0,this.total=0,this.lista_impuestos=[],this.lista_impuestos=[];for(var t=0;t<this.impuestos.length;t++)this.lista_impuestos.push({id:this.impuestos[t].id,simpuesto:this.impuestos[t].simpuesto,total:0,idempresa:this.impuestos[t].idempresa,rporc:this.impuestos[t].rporc})}cancelarCompra(){}fechaAfip(){var t=this.fechacaicae,o=t.getUTCMonth()+1,i=t.getUTCDate(),e=t.getUTCFullYear();return e=o<10?e+"0"+o:e+""+o,i<10?e+"0"+i:e+""+i}EsNotaDeCredito(t){return"CNA"==t||"CNB"==t||"CNC"==t||"CND"==t||"PSC"==t}generarCompra(t,o){this.servicioUUID.generateUUID(),this.tipoComprobanteDeCompra(this.form_tipoDocumento),this.fecha.toISOString(),(new Date).toISOString(),this.fecha.toISOString(),this.fechacontable.toISOString(),this.EsNotaDeCredito(this.tipoComprobanteDeCompra(this.form_tipoDocumento))}verificar_iva(){this.error_iva=this.total_impuestos!=this.iva}calcular_total_impuestos(){for(var t=0,o=0;o<this.lista_impuestos.length;o++)t+=this.lista_impuestos[o].total;this.total_impuestos=parseFloat(t.toFixed(this.cantidaddecimales)),this.iva=this.total_impuestos}calcular_total(t){for(var o=0,i=0,e=0;e<this.items.length;e++)o+=this.items[e].rtotal,i+=this.items[e].rtotalneto;if(t){for(var r=0;r<this.lista_impuestos.length;r++)this.lista_impuestos[r].total=0;for(e=0;e<this.items.length;e++)for(r=0;r<this.lista_impuestos.length;r++){if(this.items[e].rporciva==this.lista_impuestos[r].rporc){this.lista_impuestos[r].total+=this.items[e].impuesto_iva;break}if(this.items[e].rporcdgr==this.lista_impuestos[r].rporc){this.lista_impuestos[r].total+=this.items[e].impuesto_dgr;break}if(this.items[e].rvalorimpinterno==this.lista_impuestos[r].rporc){this.lista_impuestos[r].total+=this.items[e].impuesto_interno;break}}for(r=0;r<this.lista_impuestos.length;r++)this.lista_impuestos[r].total=parseFloat(this.lista_impuestos[r].total.toFixed(this.cantidaddecimales))}"Factura de Compra A"==this.form_tipoDocumento||"Nota de Cr\xe9dito A"==this.form_tipoDocumento?(this.calcular_total_impuestos(),this.subtotal=parseFloat(i.toFixed(this.cantidaddecimales))):(this.subtotal=parseFloat(o.toFixed(this.cantidaddecimales)),this.iva=0),this.total=parseFloat((this.subtotal-this.form_descuento+this.iva).toFixed(this.cantidaddecimales))}}return t.\u0275fac=function(o){return new(o||t)(f.Rb(a.a),f.Rb(s.a),f.Rb(v.a),f.Rb(_),f.Rb(u.a),f.Rb(h.a),f.Rb(d.a))},t.\u0275cmp=f.Lb({type:t,selectors:[["app-new-purchase"]],decls:37,vars:22,consts:[["id","header_compras"],["fxLayout","row wrap"],["appearance","fill","fxFlex","100"],["type","text","placeholder","Proveedor","aria-label","Proveedor","matInput","",3,"formControl","matAutocomplete"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["fxLayout","row wrap","fxLayout.lt-sm","column"],["appearance","fill","fxFlex","35"],[3,"ngModel","ngModelChange"],["fxFlex","25","appearance","fill"],["name","form_numero_sucursal","matInput","","type","number","max","9999","min","0",3,"formControl"],["name","form_numero","matInput","","type","number","max","99999999","min","0",3,"formControl"],["fxFlex","15",2,"padding-top","15px"],["name","form_acredito",3,"formControl"],[3,"ngModel","ngModelChange","selectionChange"],["fxFlex","15",2,"padding-top","15px",3,"hidden"],["name","form_afectarStock",3,"formControl"],["appearance","fill","fxFlex","35",4,"ngIf"],[3,"value"]],template:function(t,o){if(1&t&&(f.Xb(0,"div",0),f.Xb(1,"div",1),f.Xb(2,"mat-form-field",2),f.Sb(3,"input",3),f.Xb(4,"mat-autocomplete",4,5),f.fc("optionSelected",function(t){return o.cambiarProveedor(t.option.value)}),f.Mc(6,x,2,2,"mat-option",6),f.kc(7,"async"),f.Wb(),f.Wb(),f.Wb(),f.Xb(8,"div",7),f.Xb(9,"mat-form-field",8),f.Xb(10,"mat-label"),f.Oc(11),f.kc(12,"translate"),f.Wb(),f.Xb(13,"mat-select",9),f.fc("ngModelChange",function(t){return o.form_tipoDocumento=t}),f.Mc(14,N,2,2,"mat-option",6),f.Wb(),f.Wb(),f.Xb(15,"mat-form-field",10),f.Xb(16,"mat-label"),f.Oc(17,"N\xfamero (primeros 4 d\xedgitos)"),f.Wb(),f.Sb(18,"input",11),f.Wb(),f.Xb(19,"mat-form-field",10),f.Xb(20,"mat-label"),f.Oc(21,"N\xfamero (\xfaltimos 8 d\xedgitos)"),f.Wb(),f.Sb(22,"input",12),f.Wb(),f.Xb(23,"div",13),f.Xb(24,"mat-checkbox",14),f.Oc(25,"A Cr\xe9dito"),f.Wb(),f.Wb(),f.Wb(),f.Xb(26,"div",7),f.Xb(27,"mat-form-field",8),f.Xb(28,"mat-label"),f.Oc(29),f.kc(30,"translate"),f.Wb(),f.Xb(31,"mat-select",15),f.fc("ngModelChange",function(t){return o.form_tipoFactura=t})("selectionChange",function(){return o.cambiarTiposFactura()}),f.Mc(32,M,2,2,"mat-option",6),f.Wb(),f.Wb(),f.Xb(33,"div",16),f.Xb(34,"mat-checkbox",17),f.Oc(35,"Afectar Stock"),f.Wb(),f.Wb(),f.Mc(36,E,6,5,"mat-form-field",18),f.Wb(),f.Wb()),2&t){const t=f.Ac(5);f.Eb(3),f.pc("formControl",o.editorProveedor)("matAutocomplete",t),f.Eb(1),f.pc("displayWith",o.displayFnProveedores),f.Eb(2),f.pc("ngForOf",f.lc(7,16,o.filteredProveedores)),f.Eb(5),f.Pc(f.lc(12,18,"Documento")),f.Eb(2),f.pc("ngModel",o.form_tipoDocumento),f.Eb(1),f.pc("ngForOf",o.tiposDocumento),f.Eb(4),f.pc("formControl",o.form_numero_sucursal),f.Eb(4),f.pc("formControl",o.form_numero),f.Eb(2),f.pc("formControl",o.form_acredito),f.Eb(5),f.Pc(f.lc(30,20,"Tipo de Factura")),f.Eb(2),f.pc("ngModel",o.form_tipoFactura),f.Eb(1),f.pc("ngForOf",o.tiposFactura),f.Eb(1),f.pc("hidden",o.form_tipoFactura!=o.tiposFactura[0]),f.Eb(1),f.pc("formControl",o.form_afectarStock),f.Eb(2),f.pc("ngIf",o.form_tipoFactura==o.tiposFactura[0]&&o.form_afectarStock.value)}},directives:[C.c,F.c,C.a,g.b,r.c,D.c,r.o,r.f,D.a,e.n,F.f,P.a,r.r,r.s,w.a,e.o,O.n],pipes:[e.b,S.c],styles:[""]}),t})(),data:{title:"NUEVA COMPRA"}}];var A=i("iInd"),y=i("u9T3"),R=i("Dxy4"),X=i("PDjf"),k=i("f44v"),U=i("iELJ"),T=i("Tj54"),B=i("jMqV"),L=i("M9ds"),j=i("ZFy/"),V=i("w9WL"),q=i("PCNd"),z=i("BxcV"),J=i("n1FK"),Q=i("TN/R");let K=(()=>{class t{}return t.\u0275mod=f.Pb({type:t}),t.\u0275inj=f.Ob({factory:function(o){return new(o||t)},imports:[[e.c,r.t,y.a,V.f,g.c,g.c,X.c,g.c,R.c,k.a,g.c,j.b,U.f,v.b,B.b,L.c,P.b,T.b,S.b,q.a,D.b,z.a,r.j,Q.g,J.c,J.e,J.d,w.b,A.k.forChild(W)]]}),t})()}}]);