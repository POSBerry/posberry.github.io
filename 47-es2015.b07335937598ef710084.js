(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{"2Doj":function(t,o,i){"use strict";i.r(o),i.d(o,"NewPurchaseModule",function(){return B});var s=i("SVse"),r=i("3sEA"),e=i("vpPe"),a=i("wd/R"),c=i("cp0P"),h=i("Sp5M"),p=i("qA6C"),m=i("UVsP"),u=i("AytR"),d=i("8Y7J"),n=i("IheW");let l=(()=>{class t{constructor(t){this.http=t}obtenerImpuestos(){return this.http.get(u.a.apiURL+'Impuestos?filter={"where":{"deletedon":{"eq":null}}}')}obtenerSucursales(){return this.http.get(u.a.apiURL+'Sucursales?filter={"where":{"deletedon":{"eq":null}}}')}}return t.\u0275fac=function(o){return new(o||t)(d.bc(n.c))},t.\u0275prov=d.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var f=i("zHaW");const _=[{path:"",component:(()=>{class t{constructor(t,o,i,s,r,e,c){this.servicioUUID=t,this.loader=o,this.snack=i,this.servicioNuevaCompra=s,this.servicioProductos=r,this.servicioEmpresas=e,this.servicioSucursales=c,this.sucursal="",this.form_tipoFactura="",this.form_tipoDocumento="",this.error_iva=!1,this.tipoFacturaBloqueado=!1,this.sucursal="",this.tiposDocumento=[],this.tiposFactura=["PRODUCTOS","SERVICIOS"],this.detalle=[],this.detalleimpuestos=[],this.fechaFiltroInicio=new Date,this.fechaFiltroFin=a().add(1,"days").toDate()}ngOnInit(){this.loader.open(),this.servicioProductos.traerProductos("snombre ASC",()=>{this.productos=this.servicioProductos.listaProductos,Object(c.a)([this.servicioEmpresas.obtenerEmpresas(),this.servicioProductos.obtenerProveedores(),this.servicioNuevaCompra.obtenerImpuestos(),this.servicioNuevaCompra.obtenerSucursales()]).subscribe(t=>{this.empresas=t[0],this.cantidaddecimales=t[0].cantidaddecimales,this.proveedores=t[1],this.impuestos=t[2],this.sucursales_data=t[3],this.loader.close()},t=>{this.loader.close(),this.snack.open("ERROR","OK",{duration:4e3})})},t=>{this.loader.close(),this.snack.open("ERROR","OK",{duration:4e3})})}renameKeys(t,o){const i=Object.keys(t).map(i=>({[o[i]||i]:t[i]}));return Object.assign({},...i)}obtenerNombreProveedor(t){if(this.proveedores)for(var o=0;o<this.proveedores.length;o++)if(this.proveedores[o].id==t)return this.proveedores[o].srazonsocial;return""}obtenerNombreProducto(t,o){for(var i=0;i<this.productos.length;i++)if(this.productos[i].id==t)return this.productos[i].snombre;return o}obtenerCodigoProducto(t){for(var o=0;o<this.productos.length;o++)if(this.productos[o].id==t)return this.productos[o].scodproducto;return""}cambiarProveedor(t){var o="T"==t.bdeproductos,i="T"==t.bdeservicios;this.tipoFacturaBloqueado=!1,this.form_tipoFactura=this.tiposFactura[0],o&&!i&&(this.tipoFacturaBloqueado=!0,this.form_tipoFactura=this.tiposFactura[0]),i&&!o&&(this.tipoFacturaBloqueado=!0,this.form_tipoFactura=this.tiposFactura[1]),this.cargarTiposDocumento(t.scondicioniva,o)}cargarTiposDocumento(t,o){this.tiposDocumento=["Presupuesto de Compra","Nota de Cr\xe9dito Presupuesto de Compra"],this.form_tipoDocumento="Presupuesto de Compra",o&&this.tiposDocumento.push("Remito de Compra"),"Monotributista"==this.empresas[0].scondicioniva&&("Responsable Inscripto"==t&&(this.tiposDocumento.push("Factura de Compra B"),this.tiposDocumento.push("Nota de Cr\xe9dito B"),this.form_tipoDocumento="Factura de Compra B"),"Monotributista"==t&&(this.tiposDocumento.push("Factura de Compra C"),this.tiposDocumento.push("Nota de Cr\xe9dito C"),this.form_tipoDocumento="Factura de Compra C")),"Responsable Inscripto"==this.empresas[0].scondicioniva&&("Responsable Inscripto"==t&&(this.tiposDocumento.push("Factura de Compra A"),this.tiposDocumento.push("Nota de Cr\xe9dito A"),this.form_tipoDocumento="Factura de Compra A"),"Monotributista"==t&&(this.tiposDocumento.push("Factura de Compra C"),this.tiposDocumento.push("Nota de Cr\xe9dito C"),this.form_tipoDocumento="Factura de Compra C")),"Consumidor Final"==this.empresas[0].scondicioniva&&("Responsable Inscripto"==t&&(this.tiposDocumento.push("Factura de Compra B"),this.tiposDocumento.push("Nota de Cr\xe9dito B"),this.form_tipoDocumento="Factura de Compra B"),"Monotributista"==t&&(this.tiposDocumento.push("Factura de Compra C"),this.tiposDocumento.push("Nota de Cr\xe9dito C"),this.form_tipoDocumento="Factura de Compra C"))}buscarProducto(t){for(var o=0;o<this.productos.length;o++)if(this.productos[o].id==t)return this.productos[o];return{}}editarItem(t){this.temp_item=t,this.form_tipoFactura==this.tiposFactura[0]?(this.form_precio=t.rpreciou,this.form_cantidad=t.rcantidad,this.form_producto=this.buscarProducto(t.idproducto)):(this.form_precio=t.rpreciou,this.form_cantidad=t.rcantidad,this.form_producto=t.sconcepto)}eliminarItem(t){var o=this.items.indexOf(t);this.items.splice(o,1),this.calcular_total(!0)}guardarItem(){this.form_cantidad=this.form_cantidad?this.form_cantidad:1;var t=this.items.indexOf(this.temp_item),o=this.form_precio,i=this.form_precio_final;"Factura de Compra A"!=this.form_tipoDocumento&&"Nota de Cr\xe9dito A"!=this.form_tipoDocumento&&(o=parseFloat((i.formatMoneySinMiles(2)/1.21).toFixed(this.cantidaddecimales))),-1!=t?(this.form_tipoFactura==this.tiposFactura[0]?(this.items[t].idproducto=this.form_producto.id,this.items[t].rcantidad=this.form_cantidad,this.items[t].rpreciou=i,this.items[t].rprecioneto=o,this.items[t].rporciva=this.form_producto.rporciva,this.items[t].rtotal=i*this.form_cantidad,this.items[t].rtotalneto=o*this.form_cantidad,this.items[t].rimpuestos=Math.abs(i-o),this.items[t].sconcepto=this.form_producto.snombre):(this.items[t].idproducto=null,this.items[t].rcantidad=this.form_cantidad,this.items[t].rpreciou=i,this.items[t].rprecioneto=o,this.items[t].rporciva=21,this.items[t].rtotal=i*this.form_cantidad,this.items[t].rtotalneto=o*this.form_cantidad,this.items[t].rimpuestos=Math.abs(i-o),this.items[t].sconcepto=this.form_producto),this.items[t].impuesto_iva=this.items[t].rporciva/100*this.items[t].rtotalneto,this.items[t].impuesto_dgr=this.items[t].rporcdgr/100*this.items[t].rtotalneto,this.items[t].impuesto_interno=this.items[t].rvalorimpinterno*this.items[t].rcantidad):(this.items.push(this.form_tipoFactura==this.tiposFactura[0]?{id:this.servicioUUID.generateUUID(),idproducto:this.form_producto.id,rcantidad:this.form_cantidad,rpreciou:i,rprecioneto:o,rporciva:this.form_producto.rporciva,rtotal:this.form_cantidad*i,rtotalneto:o*this.form_cantidad,rimpuestos:Math.abs(i-o),sconcepto:this.form_producto.snombre}:{id:this.servicioUUID.generateUUID(),idproducto:null,rcantidad:this.form_cantidad,rpreciou:i,rprecioneto:o,rporciva:21,rtotal:this.form_cantidad*i,rtotalneto:o*this.form_cantidad,rimpuestos:Math.abs(i-o),sconcepto:this.form_producto}),this.items[this.items.length-1].impuesto_iva=this.items[this.items.length-1].rporciva/100*this.items[this.items.length-1].rtotalneto,this.items[this.items.length-1].impuesto_dgr=this.items[this.items.length-1].rporcdgr/100*this.items[this.items.length-1].rtotalneto,this.items[this.items.length-1].impuesto_interno=this.items[this.items.length-1].rvalorimpinterno*this.items[this.items.length-1].rcantidad),this.form_precio=0,this.form_precio_final=0,this.form_cantidad=1,this.form_producto="",this.temp_item=null,this.calcular_total(!0)}tipoComprobanteDeCompra(t){return"Presupuesto de Compra"==t?"PDC":"Remito de Compra"==t?"RMC":"Factura de Compra A"==t?"CCA":"Factura de Compra B"==t?"CCB":"Factura de Compra C"==t?"CCC":"Nota de Cr\xe9dito A"==t?"CNA":"Nota de Cr\xe9dito B"==t?"CNB":"Nota de Cr\xe9dito C"==t?"CNC":"Nota de Cr\xe9dito Presupuesto de Compra"==t?"PSC":void 0}querySearch(t){if(""==t)return this.proveedores;var o=[];t=(t=t.toLowerCase()).split(" ");for(var i=0;i<this.proveedores.length;i++){for(var s=this.proveedores[i].srazonsocial.toLowerCase(),r=!0,e=0;e<t.length;e++)if(-1==s.indexOf(t[e])){r=!1;break}r&&o.push(this.proveedores[i])}return o}querySearchProducto(t){if(""==t)return this.productos;var o=[];t=(t=t.toLowerCase()).split(" ");for(var i=0;i<this.productos.length;i++)for(var s=this.productos[i],r=0;r<t.length;r++){var e=t[r];if(-1==s.snombre.toLowerCase().indexOf(e)&&s.scodproducto.toLowerCase()!=e&&s.sean!=e&&s.sean2!=e)break;o.push(this.productos[i])}return o}selectedItemChangeProducto(t){t&&null!=t.rcostou&&(this.form_precio=t.rcostou),this.calcular_precio_neto(),this.calcular_precio_final()}calcular_precio_neto(){var t=this.form_producto;"Factura de Compra A"!=this.form_tipoDocumento&&"Nota de Cr\xe9dito A"!=this.form_tipoDocumento||(this.form_precio=parseFloat(((t.rcostou-t.rvalorimpinterno)/(t.rporciva/100+t.rporcdgr/100+1)).toFixed(this.cantidaddecimales)),this.form_precio=t&&t.rcostou&&t.rporciva&&t.rporcdgr&&null!=t.rvalorimpinterno?parseFloat(((t.rcostou-t.rvalorimpinterno)/(t.rporciva/100+t.rporcdgr/100+1)).toFixed(this.cantidaddecimales)):0)}calcular_precio_final(){var t=this.form_producto;this.form_precio_final="Factura de Compra A"==this.form_tipoDocumento||"Nota de Cr\xe9dito A"==this.form_tipoDocumento?parseFloat((this.form_precio*(t.rporciva/100+t.rporcdgr/100+1)+t.rvalorimpinterno).toFixed(this.cantidaddecimales).formatMoneySinMiles(2)):this.form_precio}nuevaCompra(){this.form_proveedor="",this.fecha=new Date,this.fechacontable=new Date,this.fechacaicae=a().add(10,"days").toDate(),this.items=[],this.form_precio=0,this.form_cantidad=1,this.form_producto="",this.form_tipoFactura=this.tiposFactura[0],this.form_tipoDocumento=this.tiposDocumento[0],this.form_numero="",this.form_caicae="",this.form_afectarStock=!1,this.form_descuento=0,this.form_proveedor=this.proveedores[0],this.subtotal=0,this.iva=0,this.total=0,this.lista_impuestos=[],this.lista_impuestos=[];for(var t=0;t<this.impuestos.length;t++)this.lista_impuestos.push({id:this.impuestos[t].id,simpuesto:this.impuestos[t].simpuesto,total:0,idempresa:this.impuestos[t].idempresa,rporc:this.impuestos[t].rporc})}cancelarCompra(){}fechaAfip(){var t=this.fechacaicae,o=t.getUTCMonth()+1,i=t.getUTCDate(),s=t.getUTCFullYear();return s=o<10?s+"0"+o:s+""+o,i<10?s+"0"+i:s+""+i}EsNotaDeCredito(t){return"CNA"==t||"CNB"==t||"CNC"==t||"CND"==t||"PSC"==t}generarCompra(t,o){this.servicioUUID.generateUUID(),this.tipoComprobanteDeCompra(this.form_tipoDocumento),this.fecha.toISOString(),(new Date).toISOString(),this.fecha.toISOString(),this.fechacontable.toISOString(),this.EsNotaDeCredito(this.tipoComprobanteDeCompra(this.form_tipoDocumento))}verificar_iva(){this.error_iva=this.total_impuestos!=this.iva}calcular_total_impuestos(){for(var t=0,o=0;o<this.lista_impuestos.length;o++)t+=this.lista_impuestos[o].total;this.total_impuestos=parseFloat(t.toFixed(this.cantidaddecimales)),this.iva=this.total_impuestos}calcular_total(t){for(var o=0,i=0,s=0;s<this.items.length;s++)o+=this.items[s].rtotal,i+=this.items[s].rtotalneto;if(t){for(var r=0;r<this.lista_impuestos.length;r++)this.lista_impuestos[r].total=0;for(s=0;s<this.items.length;s++)for(r=0;r<this.lista_impuestos.length;r++){if(this.items[s].rporciva==this.lista_impuestos[r].rporc){this.lista_impuestos[r].total+=this.items[s].impuesto_iva;break}if(this.items[s].rporcdgr==this.lista_impuestos[r].rporc){this.lista_impuestos[r].total+=this.items[s].impuesto_dgr;break}if(this.items[s].rvalorimpinterno==this.lista_impuestos[r].rporc){this.lista_impuestos[r].total+=this.items[s].impuesto_interno;break}}for(r=0;r<this.lista_impuestos.length;r++)this.lista_impuestos[r].total=parseFloat(this.lista_impuestos[r].total.toFixed(this.cantidaddecimales))}"Factura de Compra A"==this.form_tipoDocumento||"Nota de Cr\xe9dito A"==this.form_tipoDocumento?(this.calcular_total_impuestos(),this.subtotal=parseFloat(i.toFixed(this.cantidaddecimales))):(this.subtotal=parseFloat(o.toFixed(this.cantidaddecimales)),this.iva=0),this.total=parseFloat((this.subtotal-this.form_descuento+this.iva).toFixed(this.cantidaddecimales))}}return t.\u0275fac=function(o){return new(o||t)(d.Rb(e.a),d.Rb(r.a),d.Rb(f.a),d.Rb(l),d.Rb(p.a),d.Rb(h.a),d.Rb(m.a))},t.\u0275cmp=d.Lb({type:t,selectors:[["app-new-purchase"]],decls:2,vars:0,template:function(t,o){1&t&&(d.Xb(0,"p"),d.Oc(1,"new-purchase works!"),d.Wb())},styles:[""]}),t})(),data:{title:"NUEVA COMPRA"}}];var C=i("iInd"),v=i("u9T3"),b=i("s7LF"),F=i("Dxy4"),D=i("PDjf"),g=i("f44v"),N=i("iELJ"),P=i("Tj54"),I=i("e6WT"),R=i("ZTz/"),S=i("jMqV"),w=i("M9ds"),A=i("ZFy/"),O=i("TSSN"),U=i("w9WL"),M=i("PCNd"),y=i("BxcV");let B=(()=>{class t{}return t.\u0275mod=d.Pb({type:t}),t.\u0275inj=d.Ob({factory:function(o){return new(o||t)},imports:[[s.c,b.t,v.a,U.f,I.c,I.c,D.c,I.c,F.c,g.a,I.c,A.b,N.f,f.b,S.b,w.c,R.b,P.b,O.b,M.a,y.a,C.k.forChild(_)]]}),t})()}}]);